{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.8.7", "generated_at": "2024-10-11T12:11:08.378572Z", "invocation_id": "723fc858-748c-4922-959e-958ad7e34bec", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.085497Z", "completed_at": "2024-10-11T12:11:08.102768Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.106345Z", "completed_at": "2024-10-11T12:11:08.106382Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0528562068939209, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.transformed_contact_number", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_id,\n        contact_phone_numbers\n    FROM \"medical_data\".\"public\".\"transformed_medical_product\"\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''  -- Filter out any null or empty paths\n)\n\nSELECT DISTINCT ON (channel_id)  -- Ensure unique channel usernames\n    channel_id,\n    contact_phone_numbers  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"medical_data\".\"public\".\"transformed_contact_number\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.073870Z", "completed_at": "2024-10-11T12:11:08.104246Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.108579Z", "completed_at": "2024-10-11T12:11:08.108592Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05769610404968262, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.transfomed_product", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_id,\n        message_id as product_id,\n        product_name,\n        price_in_birr  -- Rename the column to be clearer\n    FROM \"medical_data\".\"public\".\"transformed_medical_product\"\n)\n\nSELECT   -- Ensure unique channel usernames\n    channel_id,\n    product_id,\n    product_name,\n    price_in_birr  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"medical_data\".\"public\".\"transfomed_product\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.059466Z", "completed_at": "2024-10-11T12:11:08.104877Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.109875Z", "completed_at": "2024-10-11T12:11:08.109895Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.06009793281555176, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.ethio_medical", "compiled": true, "compiled_code": "-- models/ethio_medical.sql\n  -- Correcting the materialization syntax\n\nWITH source_data AS (\n    SELECT * \n    FROM \"medical_data\".\"public\".\"ethio_medical\"  -- Use DBT's source function\n)\n\nSELECT\n    channel_id,\n    channel_title,\n    lower(channel_username) AS channel_username,\n    message_id,\n    \"Message\",\n    date,\n    media_path\nFROM source_data\nWHERE \"Message\" IS NOT NULL", "relation_name": "\"medical_data\".\"public\".\"ethio_medical\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.078791Z", "completed_at": "2024-10-11T12:11:08.105543Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.111479Z", "completed_at": "2024-10-11T12:11:08.111493Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.059812307357788086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.transformed_channel", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT\n        channel_id,\n        channel_username,\n        channel_title\n    FROM \"medical_data\".\"public\".\"transformed_medical_product\"\n    WHERE contact_phone_numbers IS NOT NULL AND contact_phone_numbers != ''  -- Filter out any null or empty paths\n)\n\nSELECT DISTINCT ON (channel_id)  -- Ensure unique channel usernames\n    channel_id,\n    channel_username,\n    channel_title  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"medical_data\".\"public\".\"transformed_channel\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.124931Z", "completed_at": "2024-10-11T12:11:08.191194Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.195874Z", "completed_at": "2024-10-11T12:11:08.195913Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0783534049987793, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.transformed_medical_product", "compiled": true, "compiled_code": "\n\nWITH source_data AS (\n    SELECT * \n    FROM \"medical_data\".\"public\".\"ethio_medical\"\n),\nphone_extracted AS (\n    SELECT\n        channel_id,\n        message_id,\n        channel_title,\n        lower(channel_username) AS channel_username,\n        \"Message\",\n        date,\n        media_path,  -- Ensure this is being selected\n        -- Extract phone numbers with optional spaces\n        array_to_string(ARRAY(\n            SELECT regexp_replace(unnest(regexp_matches(\"Message\", '09\\s*[0-9]{8}', 'g')), '\\s+', '', 'g')\n        ), ', ') AS phone_numbers,\n        -- Clean the message of phone numbers\n        regexp_replace(\n            \"Message\", \n            '09\\s*[0-9]{8}', \n            '', \n            'g'\n        ) AS cleaned_message\n    FROM source_data\n),\nproduct_price_extracted AS (\n    SELECT\n        channel_id,\n        message_id,\n        channel_title,\n        channel_username,\n        date,\n        TRIM(cleaned_message) AS cleaned_message,\n        phone_numbers,\n        -- Adjusted regex to capture product names and prices\n        regexp_matches(cleaned_message, '^(.*?)\\s*(?:price|Price|PRICE)\\s*(\\d+)\\s*(birr|ETB)', 'g') AS matches,\n        media_path,  -- Include media_path here\n        ROW_NUMBER() OVER (PARTITION BY message_id ORDER BY date DESC) AS rn  -- Add row number to filter\n    FROM phone_extracted\n)\n\nSELECT\n    channel_id,\n    message_id,\n    channel_title,\n    channel_username,\n    date,\n    TRIM(matches[1]) AS product_name,  -- Extract product name\n    CAST(TRIM(matches[2]) AS INTEGER) AS price_in_birr,  -- Extract price as an integer\n    media_path,  -- Include media_path in the final selection\n    CASE\n        WHEN phone_numbers IS NOT NULL AND phone_numbers != '' THEN phone_numbers\n        ELSE NULL\n    END AS contact_phone_numbers  -- Renamed for clarity\nFROM product_price_extracted\nWHERE matches IS NOT NULL  -- Filter out any rows where matches are not found\nAND rn = 1  -- Select only the first occurrence of each message_id\nAND TRIM(matches[1]) <> ''  -- Drop empty product names\nAND TRIM(matches[1]) <> TRIM(matches[2])  -- Drop rows where product name and price are the same\nORDER BY message_id  -- Optional: order by message_id", "relation_name": "\"medical_data\".\"public\".\"transformed_medical_product\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.153272Z", "completed_at": "2024-10-11T12:11:08.193084Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.198259Z", "completed_at": "2024-10-11T12:11:08.198283Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.07776331901550293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_contact_number_contact_phone_numbers.fb535ed729", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect contact_phone_numbers\nfrom \"medical_data\".\"public\".\"transformed_contact_number\"\nwhere contact_phone_numbers is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.132475Z", "completed_at": "2024-10-11T12:11:08.194407Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.201475Z", "completed_at": "2024-10-11T12:11:08.201499Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.08255958557128906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.ethio_medical_project.transformed_product_images", "compiled": true, "compiled_code": "-- models/transformed_product_images.sql\n\n\nWITH source_data AS (\n    SELECT \n        message_id,\n        media_path  -- Assuming this column contains the image paths\n    FROM \"medical_data\".\"public\".\"transformed_medical_product\"\n    WHERE media_path IS NOT NULL AND media_path != ''  -- Filter out any null or empty paths\n)\n\nSELECT\n    message_id,\n    media_path AS image_path  -- Rename the column to be clearer\nFROM source_data", "relation_name": "\"medical_data\".\"public\".\"transformed_product_images\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.137334Z", "completed_at": "2024-10-11T12:11:08.200630Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.206472Z", "completed_at": "2024-10-11T12:11:08.206521Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0868377685546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_contact_number_channel_id.e7b12be452", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_id\nfrom \"medical_data\".\"public\".\"transformed_contact_number\"\nwhere channel_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.221824Z", "completed_at": "2024-10-11T12:11:08.271073Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.281194Z", "completed_at": "2024-10-11T12:11:08.281222Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.07124066352844238, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.unique_transformed_contact_number_channel_id.50775b23dd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    channel_id as unique_field,\n    count(*) as n_records\n\nfrom \"medical_data\".\"public\".\"transformed_contact_number\"\nwhere channel_id is not null\ngroup by channel_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.239850Z", "completed_at": "2024-10-11T12:11:08.279264Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.286544Z", "completed_at": "2024-10-11T12:11:08.286569Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0749197006225586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_channel_channel_title.125e643652", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_title\nfrom \"medical_data\".\"public\".\"transformed_channel\"\nwhere channel_title is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.253069Z", "completed_at": "2024-10-11T12:11:08.284047Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.292412Z", "completed_at": "2024-10-11T12:11:08.292437Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.07776570320129395, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_channel_channel_username.da1cdd12f9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect channel_username\nfrom \"medical_data\".\"public\".\"transformed_channel\"\nwhere channel_username is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.265756Z", "completed_at": "2024-10-11T12:11:08.289066Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.296987Z", "completed_at": "2024-10-11T12:11:08.297016Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.07811141014099121, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.unique_transformed_channel_channel_username.473920f54c", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    channel_username as unique_field,\n    count(*) as n_records\n\nfrom \"medical_data\".\"public\".\"transformed_channel\"\nwhere channel_username is not null\ngroup by channel_username\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.310350Z", "completed_at": "2024-10-11T12:11:08.344081Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.358018Z", "completed_at": "2024-10-11T12:11:08.358044Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05864715576171875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_product_images_image_path.63ab13f217", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect image_path\nfrom \"medical_data\".\"public\".\"transformed_product_images\"\nwhere image_path is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.324922Z", "completed_at": "2024-10-11T12:11:08.360692Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.363478Z", "completed_at": "2024-10-11T12:11:08.363501Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.060402870178222656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.not_null_transformed_product_images_message_id.d0b65198ff", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect message_id\nfrom \"medical_data\".\"public\".\"transformed_product_images\"\nwhere message_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-10-11T12:11:08.338620Z", "completed_at": "2024-10-11T12:11:08.366190Z"}, {"name": "execute", "started_at": "2024-10-11T12:11:08.368165Z", "completed_at": "2024-10-11T12:11:08.368188Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06138777732849121, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.ethio_medical_project.unique_transformed_product_images_message_id.ac309998fa", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    message_id as unique_field,\n    count(*) as n_records\n\nfrom \"medical_data\".\"public\".\"transformed_product_images\"\nwhere message_id is not null\ngroup by message_id\nhaving count(*) > 1\n\n\n", "relation_name": null}], "elapsed_time": 0.5031859874725342, "args": {"populate_cache": true, "empty_catalog": false, "version_check": true, "static_parser": true, "source_freshness_run_project_hooks": false, "partial_parse": true, "strict_mode": false, "vars": {}, "print": true, "exclude": [], "show_resource_report": false, "log_path": "/home/noh/10Academy/EthiomedDataWarehouse/ethio_medical_project/logs", "project_dir": "/home/noh/10Academy/EthiomedDataWarehouse/ethio_medical_project", "send_anonymous_usage_stats": true, "enable_legacy_logger": false, "log_level_file": "debug", "favor_state": false, "log_file_max_bytes": 10485760, "select": [], "macro_debugging": false, "log_format": "default", "printer_width": 80, "defer": false, "invocation_command": "dbt docs generate", "require_resource_names_without_spaces": false, "log_format_file": "debug", "static": false, "require_explicit_package_overrides_for_builtin_materializations": true, "profiles_dir": "/home/noh/.dbt", "cache_selected_only": false, "which": "generate", "partial_parse_file_diff": true, "compile": true, "quiet": false, "use_colors_file": true, "warn_error_options": {"include": [], "exclude": []}, "use_colors": true, "log_level": "info", "write_json": true, "introspect": true, "indirect_selection": "eager"}}